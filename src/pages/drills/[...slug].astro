---
import { getCollection } from "astro:content";
import DrillLayout from "../../layouts/DrillLayout.astro";
import { categoryLabel } from "../../lib/categories";

export async function getStaticPaths() {
  const drills = await getCollection("drills");
  return drills.map((d) => ({
    params: { slug: d.slug },
    props: { drill: d },
  }));
}

const { drill } = Astro.props;

const meta: string[] = [];
if (drill.data.level) meta.push(drill.data.level);
if (drill.data.time_minutes) meta.push(`${drill.data.time_minutes} min`);
if (drill.data.group_size) meta.push(drill.data.group_size);
meta.push(categoryLabel(drill.data.primary_category ?? drill.data.categories[0]));
---
<DrillLayout title={drill.data.title} summary={drill.data.summary} meta={meta}>
  <div>
    <div class="meta" style="margin-bottom:10px;">
      {drill.data.categories.map((c) => (
        <a class="pill" href={`${Astro.base}drills/?cat=${encodeURIComponent(c)}`} style="color:var(--text); text-decoration:none;">
          {categoryLabel(c)}
        </a>
      ))}
    </div>

    <article class="prose">
      <slot />
    </article>

    {drill.data.video_url ? (
      <>
        <hr class="sep" />
        <p class="sub">Video:</p>
        <p><a href={drill.data.video_url} target="_blank" rel="noreferrer">{drill.data.video_url}</a></p>
      </>
    ) : null}

    <hr class="sep" />
    <a class="chip" href={`${Astro.base}drills/`}>‚Üê Back to drills</a>
  </div>
</DrillLayout>
